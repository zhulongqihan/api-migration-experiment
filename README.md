# APIç‰ˆæœ¬è¿ç§»å®éªŒ ğŸš€

## ğŸ“– é¡¹ç›®ç®€ä»‹

æ¢ç´¢åœ¨ä¸é¢‘ç¹å…¨é‡å¾®è°ƒçš„å‰æä¸‹ï¼Œä½¿ä¸­å°è§„æ¨¡ä»£ç æ¨¡å‹åœ¨åŠ¨æ€APIç¯å¢ƒä¸­å¯é åœ°ç”Ÿæˆç¬¦åˆæœ€æ–°ç‰ˆåº“æ¥å£çš„ä»£ç ï¼Œé¿å…æ˜‚è´µçš„æŒç»­å¾®è°ƒä¸ç¾éš¾æ€§é—å¿˜ã€‚

## ğŸ¯ ç ”ç©¶ç›®æ ‡

**æ ¸å¿ƒé—®é¢˜**ï¼šå¦‚ä½•è®©ä»£ç ç”Ÿæˆæ¨¡å‹å¿«é€Ÿé€‚åº”APIç‰ˆæœ¬æ›´æ–°ï¼Ÿ

**è§£å†³æ€è·¯**ï¼š
1. é¿å…é¢‘ç¹å…¨é‡å¾®è°ƒï¼ˆæˆæœ¬é«˜ï¼‰
2. é˜²æ­¢ç¾éš¾æ€§é—å¿˜ï¼ˆä¿æŒå…¶ä»–èƒ½åŠ›ï¼‰
3. å®ç°ç²¾ç¡®çš„çŸ¥è¯†æ›´æ–°ï¼ˆåªæ”¹APIç›¸å…³çŸ¥è¯†ï¼‰

## ğŸ”¬ ä¸‰ä¸ªç ”ç©¶æ–¹å‘ï¼ˆå¹¶è¡Œæ¢ç´¢ï¼‰

### æ–¹å‘1ï¸âƒ£: å¼ºåŒ–å­¦ä¹ /åå¥½å¾®è°ƒï¼ˆåŸºäºReCodeæ”¹è¿›ï¼‰
- **æ ¸å¿ƒæ€æƒ³**ï¼šé€šè¿‡å¥–åŠ±å‡½æ•°å¼•å¯¼æ¨¡å‹å­¦ä¹ æ–°API
- **æŠ€æœ¯æ–¹æ¡ˆ**ï¼šGRPO/DPO + æ”¹è¿›çš„å¥–åŠ±å‡½æ•°
- **åˆ›æ–°ç‚¹**ï¼š
  - å±‚æ¬¡åŒ–LoRAï¼ˆåªæ›´æ–°æ·±å±‚è¯­ä¹‰å±‚ï¼‰
  - æ›´å¥½çš„å¥–åŠ±å‡½æ•°è®¾è®¡ï¼ˆæ‰§è¡ŒæˆåŠŸ + æµ‹è¯•é€šè¿‡ + APIæ­£ç¡®æ€§ï¼‰

### æ–¹å‘2ï¸âƒ£: ç¥ç»çŸ¥è¯†ç¼–è¾‘ï¼ˆä¸»è¦åˆ›æ–°âœ¨ï¼‰
- **æ ¸å¿ƒæ€æƒ³**ï¼šç²¾ç¡®ç¼–è¾‘æ¨¡å‹ä¸­çš„APIçŸ¥è¯†
- **æŠ€æœ¯æ–¹æ¡ˆ**ï¼šROME / MEMIT / çŸ¥è¯†é—å¿˜
- **åˆ›æ–°ç‚¹**ï¼š
  - é¦–æ¬¡å°†çŸ¥è¯†ç¼–è¾‘åº”ç”¨äºä»£ç APIæ›´æ–°
  - è¯„ä¼°ç¼–è¾‘çš„å‡†ç¡®æ€§å’Œå±€éƒ¨æ€§
  - é¿å…å½±å“æ— å…³ä»£ç ç”Ÿæˆèƒ½åŠ›

### æ–¹å‘3ï¸âƒ£: è§„åˆ™ + Promptå·¥ç¨‹ï¼ˆå¿«é€ŸBaselineï¼‰
- **æ ¸å¿ƒæ€æƒ³**ï¼šç»“åˆè§„åˆ™åŒ¹é…å’Œç²¾å¿ƒè®¾è®¡çš„Prompt
- **æŠ€æœ¯æ–¹æ¡ˆ**ï¼šè§„åˆ™åº“ + Chain-of-Thought Prompt
- **åˆ›æ–°ç‚¹**ï¼š
  - ä»æ•°æ®é›†è‡ªåŠ¨æå–æ›´æ–°è§„åˆ™
  - è®¾è®¡ä»£ç ç‰¹å®šçš„Promptæ¨¡æ¿

## ğŸ“Š å®éªŒè¿›åº¦

### âœ… é˜¶æ®µ1ï¼šç¯å¢ƒé…ç½®
- [x] æœåŠ¡å™¨é…ç½®ç¡®è®¤ï¼ˆGPU: NVIDIA RTX 3090 24GB, CUDA 11.4ï¼‰
- [x] Gitä»“åº“åˆå§‹åŒ–
- [x] condaç¯å¢ƒåˆ›å»ºï¼ˆapiupdate, Python 3.10ï¼‰
- [x] PyTorchå®‰è£…ï¼ˆ2.x+cu118ï¼Œå…¼å®¹CUDA 11.4ï¼‰
- [x] æ ¸å¿ƒä¾èµ–å®‰è£…ï¼ˆtransformers, peft, datasets, accelerateï¼‰
- [x] é¡¹ç›®ç»“æ„æ­å»º
- [x] ç¯å¢ƒæµ‹è¯•é€šè¿‡

### âœ… é˜¶æ®µ2ï¼šæ•°æ®å’Œæ¡†æ¶å‡†å¤‡
- [x] **æ•°æ®é›†åˆ›å»º**ï¼ˆ3ä¸ªè®­ç»ƒæ ·ä¾‹ + 1ä¸ªæµ‹è¯•æ ·ä¾‹ï¼‰
  - pandas: append â†’ concatï¼ˆå‡½æ•°æ›¿æ¢ï¼‰
  - numpy: keepdimså‚æ•°å˜åŒ–
  - requests: timeoutå‚æ•°æ·»åŠ 
  
- [x] **æ ¸å¿ƒæ¨¡å—å®ç°**
  - data_utils.py (95è¡Œ) - æ•°æ®åŠ è½½å·¥å…·
  - rule_extractor.py (87è¡Œ) - è§„åˆ™æå–å™¨ï¼Œ3æ¡è§„åˆ™
  - prompt_engineering.py (107è¡Œ) - 4ç§Promptç­–ç•¥
  - test_phase2.py (209è¡Œ) - å®Œæ•´æµ‹è¯•å¥—ä»¶
  
- [x] **æµ‹è¯•éªŒè¯**
  - âœ… æ•°æ®åŠ è½½æµ‹è¯•é€šè¿‡
  - âœ… è§„åˆ™æå–æµ‹è¯•é€šè¿‡ï¼ˆ3æ¡è§„åˆ™ï¼Œè¦†ç›–3ä¸ªåº“ï¼‰
  - âœ… Promptæ¨¡æ¿æµ‹è¯•é€šè¿‡ï¼ˆåŸºç¡€/ä¸Šä¸‹æ–‡/è§„åˆ™/CoTï¼‰
  - âœ… ç«¯åˆ°ç«¯æµç¨‹éªŒè¯é€šè¿‡
  - âœ… è§„åˆ™åº“ç”Ÿæˆï¼ˆconfigs/rules.json, 572å­—èŠ‚ï¼‰

**é˜¶æ®µ2æˆæœ**ï¼š
```
âœ… æ•°æ®åŠ è½½å™¨: é€šè¿‡ (3 train, 1 test)
âœ… è§„åˆ™æå–å™¨: 3æ¡è§„åˆ™ (pandas/numpy/requests)
âœ… Promptç­–ç•¥: 4ç§ (230-400å­—ç¬¦)
âœ… ç«¯åˆ°ç«¯æµ‹è¯•: å…¨éƒ¨é€šè¿‡
```

### â³ é˜¶æ®µ3ï¼šä¸‰ä¸ªæ–¹å‘ä¾æ¬¡å®ç°ï¼ˆè¿›è¡Œä¸­ï¼‰

**å®éªŒé¡ºåº**ï¼šæ–¹å‘3ï¼ˆè§„åˆ™+Promptï¼‰â†’ æ–¹å‘1ï¼ˆLoRAå¾®è°ƒï¼‰â†’ æ–¹å‘2ï¼ˆçŸ¥è¯†ç¼–è¾‘ï¼‰

#### 3.1 æ–¹å‘3ï¼šè§„åˆ™+Prompt baselineï¼ˆå·²å®Œæˆâœ…ï¼‰

**å®Œæˆæ—¶é—´**ï¼š2025-11-17  
**æœåŠ¡å™¨è·¯å¾„**ï¼š`~/api_migration_exp`

**æ‰§è¡Œçš„å…³é”®æ­¥éª¤**ï¼š
- [x] æ­¥éª¤1ï¼šç”Ÿæˆè§„åˆ™åº“ï¼ˆ`python3 test_phase2.py`ï¼‰
- [x] æ­¥éª¤2ï¼šå‡çº§PyTorchåˆ°2.6.0+cu118ï¼ˆè§£å†³ç‰ˆæœ¬å…¼å®¹é—®é¢˜ï¼‰
- [x] æ­¥éª¤3ï¼šåœ¨10ä¸ªæ ·ä¾‹ä¸Šè¿è¡Œæ¨ç†ï¼ˆ`python3 inference_baseline.py`ï¼‰
- [x] æ­¥éª¤4ï¼šè¯„ä¼°4ç§ç­–ç•¥æ•ˆæœï¼ˆ`python3 evaluate_baseline.py`ï¼‰
- [x] æ­¥éª¤5ï¼šéªŒè¯ç­–ç•¥ç¨³å®šæ€§å¹¶åˆ†æç»“æœ
- [x] æ­¥éª¤6ï¼šä¿®å¤è„šæœ¬è·¯å¾„é—®é¢˜ï¼ˆç»“æœæ–‡ä»¶ç»Ÿä¸€ä¿å­˜åˆ°é¡¹ç›®æ ¹ç›®å½•ï¼‰

**æ‰§è¡Œçš„å‘½ä»¤**ï¼š
```bash
# 1. ç¯å¢ƒå‡†å¤‡
conda activate apiupdate
cd ~/api_migration_exp/scripts

# 2. å‡çº§PyTorchï¼ˆè§£å†³å…¼å®¹æ€§é—®é¢˜ï¼‰
pip uninstall torch torchvision torchaudio -y
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118

# 3. ç”Ÿæˆè§„åˆ™åº“
python3 test_phase2.py

# 4. è¿è¡Œæ¨ç†ï¼ˆ4ç§ç­–ç•¥ï¼Œ10ä¸ªæ ·ä¾‹ï¼‰
python3 inference_baseline.py

# 5. è¯„ä¼°ç»“æœ
python3 evaluate_baseline.py
```

**ç”Ÿæˆçš„æ–‡ä»¶**ï¼š
- âœ… `configs/rules.json` - APIæ›´æ–°è§„åˆ™åº“ï¼ˆ3ä¸ªåº“ï¼Œ3æ¡è§„åˆ™ï¼‰
- âœ… `results/baseline/baseline_results_*.json` - æ¨ç†ç»“æœï¼ˆ40ä¸ªç”Ÿæˆæ ·æœ¬ï¼‰
- âœ… `results/baseline/baseline_summary_*.txt` - æ¨ç†æ‘˜è¦
- âœ… `results/baseline/evaluation_*.json` - è¯„ä¼°ç»“æœ
- âœ… `results/baseline/evaluation_*_summary.txt` - è¯„ä¼°æŠ¥å‘Š

**å®éªŒç»“æœ**ï¼ˆ10ä¸ªæ ·ä¾‹ï¼Œ4ç§ç­–ç•¥ï¼‰ï¼š

| ç­–ç•¥ | ç²¾ç¡®åŒ¹é… | å¹³å‡ç›¸ä¼¼åº¦ | å…³é”®API | å¹³å‡é•¿åº¦ | è¯„ä»· |
|------|---------|-----------|---------|---------|------|
| **basic** | **90.0%** â­ | **0.98** | **90.0%** | 34/32 | ä¼˜ç§€ |
| with_context | 80.0% | 0.98 | 90.0% | 32/32 | è‰¯å¥½ |
| with_rules | 70.0% | 0.87 | 90.0% | 47/32 | ä¸­ç­‰ |
| cot | 70.0% | 0.75 | 90.0% | 93/32 | ä¸€èˆ¬ |

**æ ¸å¿ƒç»“è®º**ï¼š
- âœ… basicç­–ç•¥è¡¨ç°ä¼˜ç§€ï¼ˆ90%ç²¾ç¡®åŒ¹é…ï¼Œ0.98ç›¸ä¼¼åº¦ï¼‰
- âœ… æ‰€æœ‰ç­–ç•¥å…³é”®APIå‡†ç¡®ç‡ç¨³å®šåœ¨90%
- âœ… ç®€å•æ˜ç¡®çš„Promptç­–ç•¥æœ€æœ‰æ•ˆ
- âœ… **Baselineæ•ˆæœå¯é ï¼Œå¯ä»¥è¿›å…¥LoRAå¾®è°ƒé˜¶æ®µ**

**å¤±è´¥æ¡ˆä¾‹**ï¼š
- è½»å¾®å·®å¼‚ï¼ˆ5ä¸ªï¼‰ï¼šç”Ÿæˆäº†é¢å¤–å‚æ•°ï¼Œå®é™…å¯èƒ½æ›´å¥½
- ç¼ºå¤±å…³é”®APIï¼ˆ1ä¸ªï¼‰ï¼šwith_rulesåœ¨pandasæ ·ä¾‹ä¸Šå¤±è´¥
- ä½ç›¸ä¼¼åº¦ï¼ˆ3ä¸ªï¼‰ï¼šcotç”Ÿæˆäº†è¿‡å¤šè§£é‡Šæ–‡æœ¬

#### 3.2 æ–¹å‘1ï¼šLoRAå¾®è°ƒï¼ˆç¯å¢ƒå°±ç»ªï¼Œå‡†å¤‡è®­ç»ƒâœ…ï¼‰

**å®Œæˆæ—¶é—´**ï¼š2025-11-17  
**æœåŠ¡å™¨è·¯å¾„**ï¼š`~/api_migration_exp/scripts/`

**ç›®æ ‡**ï¼šå®ç°å¹¶å¯¹æ¯”æ ‡å‡†LoRAå’Œå±‚æ¬¡åŒ–LoRAä¸¤ç§æ–¹æ³•

**æ ¸å¿ƒåˆ›æ–°ç‚¹**ï¼š
- ğŸ¯ **å±‚æ¬¡åŒ–LoRA**ï¼šåªæ›´æ–°æ·±å±‚ï¼ˆ22-31å±‚ï¼‰ï¼Œå‚æ•°é‡å‡å°‘~69%
- ğŸ’¡ **å‡è®¾**ï¼šæ·±å±‚è´Ÿè´£è¯­ä¹‰ç†è§£ï¼Œæ›´æ–°æ·±å±‚è¶³ä»¥é€‚é…APIå˜åŒ–
- âš¡ **ä¼˜åŠ¿**ï¼šå‚æ•°å°‘ã€è®­ç»ƒå¿«ã€å‡å°‘ç¾éš¾æ€§é—å¿˜

**å·²å®Œæˆçš„å‡†å¤‡å·¥ä½œ**ï¼š
- [x] `lora_config.py` - LoRAé…ç½®æ–‡ä»¶ï¼ˆæ ‡å‡†/å±‚æ¬¡åŒ–ï¼‰âœ…
- [x] `lora_trainer.py` - LoRAè®­ç»ƒå™¨ âœ…
- [x] `run_lora.py` - ä¸»è¿è¡Œè„šæœ¬ âœ…
- [x] `evaluate_lora.py` - è¯„ä¼°è„šæœ¬ âœ…
- [x] `compare_methods.py` - å¯¹æ¯”åˆ†æè„šæœ¬ âœ…
- [x] `LORA_QUICKSTART.md` - å¿«é€Ÿå¼€å§‹æŒ‡å— âœ…
- [x] ç¯å¢ƒä¾èµ–ä¿®å¤ï¼ˆbitsandbytesã€pandaså…¼å®¹æ€§ï¼‰âœ…
- [x] è®­ç»ƒå™¨åˆå§‹åŒ–æµ‹è¯•æˆåŠŸ âœ…

**ç¯å¢ƒéªŒè¯ç»“æœ**ï¼š
```
âœ“ æ¨¡å‹åŠ è½½æˆåŠŸ (cuda)
âœ“ LoRAé…ç½®å®Œæˆ
  å¯è®­ç»ƒå‚æ•°: 9,232,384 (0.59%)
  æ€»å‚æ•°: 1,552,946,688
âœ“ æ•°æ®é›†å‡†å¤‡å®Œæˆ: 3 ä¸ªæ ·ä¾‹
âœ“ è®­ç»ƒå™¨åˆå§‹åŒ–æˆåŠŸ
```

**æ‰§è¡Œå‘½ä»¤**ï¼š
```bash
cd ~/api_migration_exp/scripts

# 1. è®­ç»ƒæ ‡å‡†LoRAï¼ˆbaselineï¼‰
python3 run_lora.py --method standard --epochs 3 --batch_size 2

# 2. è®­ç»ƒå±‚æ¬¡åŒ–LoRAï¼ˆåˆ›æ–°æ–¹æ³•ï¼‰
python3 run_lora.py --method hierarchical --target_layers 22-31 --epochs 3 --batch_size 2

# 3. è¯„ä¼°æ ‡å‡†LoRA
python3 evaluate_lora.py --model_path ../models/checkpoints/standard_lora/final_model

# 4. è¯„ä¼°å±‚æ¬¡åŒ–LoRA
python3 evaluate_lora.py --model_path ../models/checkpoints/hierarchical_lora_layers_22-31/final_model

# 5. å¯¹æ¯”åˆ†æ
python3 compare_methods.py \
    --baseline_result ../results/baseline/evaluation_baseline_results_20251117_092534.json \
    --standard_lora_result ../models/checkpoints/standard_lora/evaluation/evaluation_results_*.json \
    --hierarchical_lora_result ../models/checkpoints/hierarchical_lora_layers_22-31/evaluation/evaluation_results_*.json
```

**é¢„è®¡æ—¶é—´**ï¼š
- æ ‡å‡†LoRAè®­ç»ƒï¼š2-3å°æ—¶
- å±‚æ¬¡åŒ–LoRAè®­ç»ƒï¼š1-2å°æ—¶ï¼ˆæ›´å¿«ï¼ï¼‰
- è¯„ä¼°å’Œåˆ†æï¼š30åˆ†é’Ÿ
- **æ€»è®¡ï¼š4-6å°æ—¶**

**ä¸‹ä¸€æ­¥æ“ä½œ**ï¼š

1. **åŒæ­¥åˆ°GitHub**ï¼ˆ5åˆ†é’Ÿï¼‰
   ```bash
   cd ~/api_migration_exp
   git add scripts/lora_*.py scripts/run_lora.py scripts/evaluate_lora.py scripts/compare_methods.py scripts/LORA_QUICKSTART.md
   git commit -m "Phase 3.2: LoRAå¾®è°ƒå®Œæ•´å®ç°"
   git push origin main
   ```

2. **å¿«é€Ÿæµ‹è¯•è®­ç»ƒ**ï¼ˆ30åˆ†é’Ÿï¼Œæ¨èå…ˆåšï¼‰
   ```bash
   cd ~/api_migration_exp/scripts
   nohup python3 run_lora.py --method hierarchical --target_layers 22-31 --epochs 1 --batch_size 2 > lora_test.log 2>&1 &
   tail -f lora_test.log
   ```

3. **å®Œæ•´è®­ç»ƒ**ï¼ˆ4-6å°æ—¶ï¼‰
   ```bash
   # å±‚æ¬¡åŒ–LoRAï¼ˆ1-2å°æ—¶ï¼‰
   nohup python3 run_lora.py --method hierarchical --target_layers 22-31 --epochs 3 --batch_size 2 > lora_hierarchical.log 2>&1 &
   
   # æ ‡å‡†LoRAï¼ˆ2-3å°æ—¶ï¼‰
   nohup python3 run_lora.py --method standard --epochs 3 --batch_size 2 > lora_standard.log 2>&1 &
   ```

**å¾…å®Œæˆä»»åŠ¡**ï¼š
- [ ] å¿«é€Ÿæµ‹è¯•è®­ç»ƒï¼ˆ1 epochï¼‰
- [ ] å®Œæ•´è®­ç»ƒæ ‡å‡†LoRAï¼ˆ3 epochsï¼‰
- [ ] å®Œæ•´è®­ç»ƒå±‚æ¬¡åŒ–LoRAï¼ˆ3 epochsï¼‰
- [ ] è¯„ä¼°ä¸¤ç§æ–¹æ³•
- [ ] å¯¹æ¯”åˆ†æç»“æœ
- [ ] æ’°å†™å®éªŒæŠ¥å‘Š

#### 3.3 æ–¹å‘2ï¼šçŸ¥è¯†ç¼–è¾‘ï¼ˆå¾…å¼€å§‹ğŸ“…ï¼‰
- [ ] ROME/MEMITå®ç°
- [ ] ä»£ç é¢†åŸŸé€‚é…
- [ ] ç¼–è¾‘æ•ˆæœè¯„ä¼°

### â³ é˜¶æ®µ4ï¼šå¯¹æ¯”åˆ†æå’Œæ¶ˆèå®éªŒï¼ˆå¾…å¼€å§‹ï¼‰
- [ ] ä¸‰ä¸ªæ–¹å‘ç»Ÿä¸€è¯„ä¼°
- [ ] æ¶ˆèå®éªŒè®¾è®¡ä¸è¿è¡Œ
- [ ] å¤±è´¥æ¡ˆä¾‹æ·±å…¥åˆ†æ
- [ ] ç¡®å®šè®ºæ–‡é‡ç‚¹æ–¹å‘

### ğŸ“ é˜¶æ®µ5ï¼šè®ºæ–‡æ’°å†™ï¼ˆå¾…å¼€å§‹ï¼‰
- [ ] è®ºæ–‡ç»“æ„è®¾è®¡
- [ ] å®éªŒç»“æœæ•´ç†
- [ ] å›¾è¡¨åˆ¶ä½œ
- [ ] è®ºæ–‡æ’°å†™å’Œä¿®æ”¹

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### æ ¸å¿ƒä¾èµ–
- **Python**: 3.10+
- **PyTorch**: 2.0+ (CUDA 11.4)
- **Transformers**: 4.36.0
- **PEFT**: 0.7.0ï¼ˆLoRAå¾®è°ƒï¼‰
- **EasyEdit**: æœ€æ–°ç‰ˆï¼ˆçŸ¥è¯†ç¼–è¾‘ï¼‰
- **Datasets**: 2.15.0

### ç¡¬ä»¶è¦æ±‚
- **GPU**: è‡³å°‘10GBæ˜¾å­˜ï¼ˆæ¨è24GBï¼‰
- **å®éªŒç¯å¢ƒ**: 2x NVIDIA RTX 3090 (24GB each)

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
api-migration-experiment/
â”œâ”€â”€ data/                      # æ•°æ®é›†
â”‚   â”œâ”€â”€ raw/                   # åŸå§‹æ•°æ®
â”‚   â”œâ”€â”€ processed/             # å¤„ç†åæ•°æ®
â”‚   â””â”€â”€ test/                  # æµ‹è¯•é›†
â”œâ”€â”€ src/                       # æºä»£ç 
â”‚   â”œâ”€â”€ baseline/              # æ–¹å‘3: è§„åˆ™+Prompt
â”‚   â”‚   â”œâ”€â”€ rule_extractor.py      # è§„åˆ™æå–
â”‚   â”‚   â”œâ”€â”€ prompt_engineering.py  # Promptè®¾è®¡
â”‚   â”‚   â””â”€â”€ run_baseline.py        # Baselineè¿è¡Œ
â”‚   â”œâ”€â”€ rl_finetuning/         # æ–¹å‘1: RLå¾®è°ƒ
â”‚   â”‚   â”œâ”€â”€ lora_finetune.py       # LoRAå¾®è°ƒ
â”‚   â”‚   â””â”€â”€ reward_function.py     # å¥–åŠ±å‡½æ•°
â”‚   â”œâ”€â”€ knowledge_editing/     # æ–¹å‘2: çŸ¥è¯†ç¼–è¾‘
â”‚   â”‚   â”œâ”€â”€ run_editing.py         # çŸ¥è¯†ç¼–è¾‘
â”‚   â”‚   â””â”€â”€ evaluate_editing.py    # ç¼–è¾‘è¯„ä¼°
â”‚   â””â”€â”€ utils/                 # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ evaluate.py            # ç»Ÿä¸€è¯„ä¼°
â”‚       â””â”€â”€ data_utils.py          # æ•°æ®å¤„ç†
â”œâ”€â”€ models/                    # æ¨¡å‹æ–‡ä»¶
â”‚   â””â”€â”€ checkpoints/           # è®­ç»ƒæ£€æŸ¥ç‚¹
â”œâ”€â”€ results/                   # å®éªŒç»“æœ
â”‚   â”œâ”€â”€ baseline/              # Baselineç»“æœ
â”‚   â”œâ”€â”€ rl/                    # RLç»“æœ
â”‚   â””â”€â”€ editing/               # ç¼–è¾‘ç»“æœ
â”œâ”€â”€ configs/                   # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ rules.json            # APIæ›´æ–°è§„åˆ™åº“
â”œâ”€â”€ scripts/                   # è¿è¡Œè„šæœ¬
â”‚   â”œâ”€â”€ setup_env.sh          # ç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ prepare_data.py       # æ•°æ®å‡†å¤‡
â”‚   â””â”€â”€ test_env.py           # ç¯å¢ƒæµ‹è¯•
â”œâ”€â”€ logs/                      # æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ docs/                      # æ–‡æ¡£
â”‚   â”œâ”€â”€ æ–°æ‰‹å®Œæ•´æŒ‡å—.md
â”‚   â”œâ”€â”€ GitåŒæ­¥æŒ‡å—.md
â”‚   â””â”€â”€ å®éªŒè®°å½•.md
â”œâ”€â”€ .gitignore                # Gitå¿½ç•¥è§„åˆ™
â”œâ”€â”€ README.md                 # é¡¹ç›®è¯´æ˜ï¼ˆæœ¬æ–‡ä»¶ï¼‰
â””â”€â”€ requirements.txt          # Pythonä¾èµ–
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®
```bash
git clone https://github.com/æ‚¨çš„ç”¨æˆ·å/api-migration-experiment.git
cd api-migration-experiment
```

### 2. åˆ›å»ºç¯å¢ƒ
```bash
# åˆ›å»ºcondaç¯å¢ƒ
conda create -n apiupdate python=3.10 -y
conda activate apiupdate

# å®‰è£…PyTorch (CUDA 11.4)
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu113

# å®‰è£…å…¶ä»–ä¾èµ–
pip install transformers==4.36.0 peft==0.7.0 datasets==2.15.0
pip install accelerate bitsandbytes libcst tqdm rich wandb
```

### 3. å‡†å¤‡æ•°æ®
```bash
python scripts/prepare_data.py
```

### 4. æµ‹è¯•ç¯å¢ƒ
```bash
python scripts/test_env.py
```

### 5. è¿è¡Œå®éªŒ

**Baselineæ–¹æ³•**:
```bash
cd src/baseline
python run_baseline.py
```

**LoRAå¾®è°ƒ**:
```bash
cd src/rl_finetuning
python lora_finetune.py
```

**çŸ¥è¯†ç¼–è¾‘**:
```bash
cd src/knowledge_editing
python run_editing.py
```

## ğŸ“ å‚è€ƒè®ºæ–‡

1. **ReCode**: Updating Code API Knowledge with Reinforcement Learning
   - arXiv: 2507.12367
   - æœºæ„: æµ™æ±Ÿå¤§å­¦ & è…¾è®¯AIè¥¿é›…å›¾å®éªŒå®¤

2. **CodeUpdateArena**: Benchmarking Knowledge Editing on API Updates
   - arXiv: 2407.06249
   - æœºæ„: The University of Texas at Austin

3. **GitChameleon 2.0**: Evaluating AI Code Generation Against Python Library Version Incompatibilities
   - arXiv: 2506.20495
   - æœºæ„: ELLIS Institute TÃ¼bingen, Mila Quebec AI Institute, Googleç­‰

### ç›¸å…³å·¥ä½œ
- ROME: Locating and Editing Factual Associations in GPT (NeurIPS 2022)
- MEMIT: Mass-Editing Memory in a Transformer (ICLR 2023)
- LoRA: Low-Rank Adaptation of Large Language Models (ICLR 2022)

## ğŸ“ˆ å®éªŒç»“æœ

### åˆæ­¥ç»“æœ

#### æ–¹å‘3ï¼šè§„åˆ™+Prompt Baselineï¼ˆä¼˜åŒ–å®Œæˆâœ…ï¼‰

**ç¬¬ä¸€è½®æµ‹è¯•ï¼ˆä¼˜åŒ–å‰ï¼‰**ï¼š

| ç­–ç•¥ | ç²¾ç¡®åŒ¹é… | ç›¸ä¼¼åº¦ | å…³é”®API | é—®é¢˜ |
|------|---------|--------|---------|------|
| basic | 0% | 0.20 | 0% | ç”Ÿæˆè§£é‡Šæ–‡æœ¬ |
| with_context | 0% | 0.21 | 100% | ç”Ÿæˆæ•™ç¨‹ |
| with_rules | 0% | 0.15 | 0% | è§„åˆ™æœªç”Ÿæ•ˆ |
| cot | 0% | 0.15 | 0% | æ¨ç†å†—é•¿ |

**ç¬¬äºŒè½®æµ‹è¯•ï¼ˆPromptä¼˜åŒ–åï¼Œ1ä¸ªæ ·ä¾‹ï¼‰**ï¼š

| ç­–ç•¥ | ç²¾ç¡®åŒ¹é… | ç›¸ä¼¼åº¦ | å…³é”®API |
|------|---------|--------|---------|
| basic | 100% | 1.00 | 100% |
| with_context | 0% | 0.78 | 100% |
| with_rules | 0% | 0.89 | 100% |
| cot | 0% | 0.78 | 100% |

**ç¬¬ä¸‰è½®æµ‹è¯•ï¼ˆæœ€ç»ˆç»“æœï¼Œ10ä¸ªæ ·ä¾‹ï¼‰**ï¼š

| ç­–ç•¥ | ç²¾ç¡®åŒ¹é… | ç›¸ä¼¼åº¦ | å…³é”®API | è¯„ä»· |
|------|---------|--------|---------|------|
| **basic** | **90%** â­ | **0.98** | **90%** | ä¼˜ç§€ä¸”ç¨³å®š |
| with_context | 80% | 0.98 | 90% | è‰¯å¥½ |
| with_rules | 70% | 0.87 | 90% | ä¸­ç­‰ |
| cot | 70% | 0.75 | 90% | ä¸€èˆ¬ |

**ä¼˜åŒ–æªæ–½**ï¼š
1. âœ… Promptæ·»åŠ ä¸¥æ ¼è¾“å‡ºçº¦æŸ
2. âœ… temperatureé™ä½ï¼ˆ0.7â†’0.3ï¼‰
3. âœ… è§„åˆ™åº“è·¯å¾„ä¿®å¤

**æ•°æ®é›†æ‰©å±•**ï¼š
- âœ… ä»1ä¸ªæ‰©å±•åˆ°10ä¸ªæµ‹è¯•æ ·ä¾‹
- âœ… è¦†ç›–8ä¸ªä¸»æµåº“ï¼ˆpandas, numpy, tensorflow, sklearn, torch, PIL, requests, matplotlibï¼‰
- âœ… åŒ…å«å¤šç§APIæ›´æ–°ç±»å‹ï¼ˆå‡½æ•°æ›¿æ¢ã€å‚æ•°å˜åŒ–ã€é‡å‘½åï¼‰

**æ ¸å¿ƒç»“è®º**ï¼š
- âœ… basicç­–ç•¥åœ¨10ä¸ªæ ·ä¾‹ä¸Šä¿æŒ90%ç²¾ç¡®åŒ¹é…ï¼ˆä¼˜ç§€ä¸”ç¨³å®šï¼‰
- âœ… æ‰€æœ‰ç­–ç•¥å…³é”®APIå‡†ç¡®ç‡90%
- âœ… ç®€å•æ˜ç¡®çš„Promptç­–ç•¥æœ€æœ‰æ•ˆ
- âœ… Baselineæ•ˆæœå¯é ï¼Œå¯ä»¥è¿›å…¥LoRAå¾®è°ƒé˜¶æ®µ

---

#### å…¶ä»–æ–¹å‘ï¼ˆå¾…è¿›è¡Œï¼‰

| æ–¹æ³• | è¯­æ³•æ­£ç¡®ç‡ | æ‰§è¡ŒæˆåŠŸç‡ | å®Œå…¨åŒ¹é…ç‡ | çŠ¶æ€ |
|------|-----------|-----------|-----------|------|
| LoRAå¾®è°ƒ | - | - | - | å¾…å¼€å§‹ |
| çŸ¥è¯†ç¼–è¾‘ (ROME) | - | - | - | å¾…å¼€å§‹ |

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æå‡ºé—®é¢˜å’Œå»ºè®®ï¼


### è¯¦ç»†æ—¥å¿—
æŸ¥çœ‹ [CHANGELOG.md](CHANGELOG.md) å’Œ [å®éªŒè¿›åº¦è®°å½•](docs/å®éªŒè¿›åº¦è®°å½•.md) è·å–å®Œæ•´çš„æ›´æ–°å†å²ã€‚

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š
- [Transformers](https://github.com/huggingface/transformers)
- [PEFT](https://github.com/huggingface/peft)
- [EasyEdit](https://github.com/zjunlp/EasyEdit)

---

**å®éªŒè¿›å±•å’Œè¯¦ç»†è®°å½•è¯·æŸ¥çœ‹ [å®éªŒè®°å½•æ–‡æ¡£](docs/å®éªŒè®°å½•.md)**

*Last updated: 2025-11-17*

---

## ğŸ“– æ›´å¤šæ–‡æ¡£

- [ç ”ç©¶æ€è·¯](ç ”ç©¶æ€è·¯.md) - ç®€å•æ˜“æ‡‚çš„ç ”ç©¶æƒ³æ³•è¯´æ˜
- [å®éªŒè·¯çº¿å›¾](å®éªŒè·¯çº¿å›¾.md) - è¯¦ç»†çš„å®éªŒæ­¥éª¤å’Œæ—¶é—´å®‰æ’
- [å®éªŒå®Œæ•´æŒ‡å—](å®éªŒå®Œæ•´æŒ‡å—.md) - æ‰‹æŠŠæ‰‹æ“ä½œæŒ‡å—
- [GitåŒæ­¥æŒ‡å—](GitåŒæ­¥æŒ‡å—.md) - GitHubæ“ä½œè¯´æ˜
- [å®éªŒè®°å½•](docs/å®éªŒè®°å½•.md) - è¯¦ç»†çš„å®éªŒæ—¥å¿—


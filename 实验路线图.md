# API版本迁移实验 - 详细路线图

## 🎯 整体实验流程

```
阶段1: 环境配置 ✅
阶段2: 数据和框架准备 ✅
阶段3: 实验运行 ⏳（当前阶段）
  └─ 3.1 方向3实现：规则+Prompt baseline
  └─ 3.2 方向1实现：LoRA微调
  └─ 3.3 方向2实现：知识编辑
阶段4: 对比分析和消融实验
阶段5: 论文写作
```

---

## 📋 阶段3详细步骤

### **3.1 方向3：规则+Prompt baseline**

#### 为什么先做这个？
- 不需要训练，最快出结果
- 建立性能基线，后面两个方向要和它比
- 验证数据集和评估流程是否合理

#### 具体任务

**任务3.1.1：解决模型加载问题**
- [ ] 配置HuggingFace镜像或使用ModelScope
- [ ] 测试加载`Qwen/Qwen2.5-Coder-1.5B`（较小，容易加载）
- [ ] 验证模型推理功能

**任务3.1.2：实现完整推理pipeline**
- [ ] 编写`inference_baseline.py`脚本
- [ ] 实现4种Prompt策略的测试
- [ ] 在mini_dataset上测试每种策略
- [ ] 输出预测结果和日志

**任务3.1.3：评估和分析**
- [ ] 实现评估指标（BLEU, CodeBLEU, 执行正确率）
- [ ] 分析每种Prompt的效果
- [ ] 统计规则覆盖率
- [ ] 记录失败case和原因

**任务3.1.4：扩展数据集**
- [ ] 收集更多API更新样例
- [ ] 从ReCode数据集提取部分数据
- [ ] 重新测试和评估

---

### **3.2 方向1：LoRA微调**

#### 核心创新点
- **标准LoRA对比组**：更新所有层
- **层次化LoRA（我们的方法）**：只更新深层（22-31层）
- **理论依据**：浅层学语法，深层学语义

#### 具体任务

**任务3.2.1：准备训练环境**
- [ ] 安装PEFT库
- [ ] 配置训练脚本模板
- [ ] 设置wandb日志（可选）

**任务3.2.2：实现标准LoRA baseline**
- [ ] 加载预训练模型
- [ ] 配置LoRA参数（rank=8, alpha=16）
- [ ] 在训练集上微调
- [ ] 在测试集上评估

**任务3.2.3：实现层次化LoRA**
- [ ] 修改LoRA配置，只更新深层
- [ ] 训练并评估
- [ ] 对比标准LoRA：性能、参数量、训练时间

**任务3.2.4：消融实验**
- [ ] 测试不同层范围（浅层 vs 中层 vs 深层）
- [ ] 测试不同rank值（4, 8, 16, 32）
- [ ] 灾难性遗忘测试（在通用代码任务上评估）

---

### **3.3 方向2：知识编辑**

#### 探索性方向
- ROME/MEMIT在代码模型上的应用
- 高风险高回报，可能效果不好

#### 具体任务

**任务3.3.1：调研和准备**
- [ ] 阅读ROME/MEMIT论文和代码
- [ ] 确定适合代码的知识编辑方法
- [ ] 准备编辑样例（API更新规则 → 知识三元组）

**任务3.3.2：实现和测试**
- [ ] 使用现有工具库（如EasyEdit）
- [ ] 在小规模数据上测试
- [ ] 评估编辑效果和泛化能力

**任务3.3.3：效果评估**
- [ ] 对比前两个方向
- [ ] 分析优缺点
- [ ] 决定是否纳入最终论文

---

## 🔄 阶段4：对比分析和消融实验

### 任务4.1：统一评估
- [ ] 在同一测试集上评估三个方向
- [ ] 统计各项指标：准确率、推理速度、资源占用
- [ ] 绘制对比图表

### 任务4.2：消融实验
- [ ] 方向1：不同LoRA配置的影响
- [ ] 方向3：规则 vs 示例 vs 推理链的作用
- [ ] 组合方法：LoRA + 规则引导Prompt

### 任务4.3：失败案例分析
- [ ] 收集每个方向的典型失败case
- [ ] 分析失败原因
- [ ] 讨论方法的局限性

---

## 📝 阶段5：论文写作

### 论文结构
1. Introduction：问题动机，贡献声明
2. Related Work：API迁移，PEFT，知识编辑
3. Method：重点描述方向1的层次化LoRA
4. Experiments：三个方向对比，消融实验
5. Analysis：成功/失败案例，讨论
6. Conclusion

### 重点突出
- **主要创新**：层次化LoRA（方向1）
- **辅助对比**：规则baseline（方向3）和知识编辑（方向2）
- **消融分析**：证明层次化设计的有效性

---

## 📅 时间估算

| 阶段 | 预计时间 | 状态 |
|-----|---------|------|
| 阶段1: 环境配置 | 已完成 | ✅ |
| 阶段2: 数据准备 | 已完成 | ✅ |
| 阶段3.1: 规则+Prompt | 1-2周 | ⏳ |
| 阶段3.2: LoRA微调 | 2-3周 | 📅 |
| 阶段3.3: 知识编辑 | 1-2周 | 📅 |
| 阶段4: 对比分析 | 1周 | 📅 |
| 阶段5: 论文写作 | 2-3周 | 📅 |



*更新时间：2025-11-06*
*当前进度：阶段2完成，准备开始阶段3.1*

